# 亚马逊选品系统需求文档

## 1. 项目概述

本项目旨在开发一个基于网页的亚马逊选品系统，用户可以通过上传从卖家精灵下载的 `xlsx` 文件（例如 `Product-Arts,Crafts&Sewing-US-Last-30-days-39193.xlsx`），解析并展示亚马逊产品信息。系统以可翻页的卡片式界面展示产品，主图位于卡片左侧，详细信息位于右侧。用户可以根据多个条件筛选产品，并通过点击卡片跳转到亚马逊产品页面。此外，系统将集成 Firebase Cloud FireStore，用于存储和管理类目黑名单，并根据黑名单筛选产品。本系统采用 Next.js 开发，旨在提供高效、直观的用户体验。

---

## 2. 功能需求

### 2.1 上传功能
- **功能描述**：用户可以上传从卖家精灵下载的 `xlsx` 文件。
- **实现细节**：
  - 支持文件类型：仅限 `.xlsx` 格式。
  - 文件解析：使用 JavaScript 库（如 `xlsx`）解析上传的文件，提取产品信息。
  - 数据提取：从文件的第一张工作表（`Sheet id="0" name="Product-US-Last-30-days"`）中提取数据，忽略其他工作表（如 `Notes`）。
  - 上传反馈：显示上传进度条，上传完成后提示成功或失败。
- **输出**：解析后的产品数据存储在前端状态中，供后续展示和筛选使用。

### 2.2 展示功能
- **功能描述**：以卡片式布局展示产品信息，支持分页浏览。
- **卡片布局**：
  - **左侧**：产品主图（从 `商品主图` 字段获取，例如 `https://m.media-amazon.com/images/I/61xFTG+mNoL._AC_US600_.jpg`）。
  - **右侧**：详细信息，包括以下字段：
    - ASIN（`ASIN` 字段，例如 `B0F2HPSKVD`）
    - 标题（`商品标题` 字段，例如 `Showgeous 12 Pack Light Blue Tablecloth 60 x 102 Inch...`）
    - 价格（`价格($)` 字段，例如 `55.99`）
    - 大类目（`大类目` 字段，例如 `Kitchen & Dining`，并且点击后需要跳转到表格该字段对应超级链接）
    - 小类目（`小类目` 字段，例如 `Tablecloths`）
    - 月销量（`月销量` 字段，例如 `630`）
    - 月销售额（`月销售额($)` 字段，例如 `35273`）
    - 评分数（`评分数` 字段，例如 `991`）
    - 评分（`评分` 字段，例如 `4.5`）
    - 上架至今（根据 `上架时间` 字段计算，例如 `2025-07-02` 至今多少天）
    - 配送方式（`配送方式` 字段，例如 `FBA`）
    - 卖家所属地（`卖家所属地` 字段，例如 `CN`）
- **交互**：
  - 点击卡片时，在新标签页中打开亚马逊产品页面（`商品详情页链接` 字段，例如 `https://www.amazon.com/dp/B0F2HPSKVD`）。
  - 支持分页，每页显示固定数量的卡片（例如 10 张），提供上一页/下一页按钮。
- **样式**：卡片布局美观，主图与信息对齐，文字清晰易读。

### 2.3 筛选功能
- **功能描述**：用户可以根据多个条件筛选产品，筛选结果实时更新。
- **筛选条件**：
  - **价格**：范围选择（例如 `$10 - $100`）。
  - **月销量**：范围选择（例如 `100 - 1000`）。
  - **月销售额**：范围选择（例如 `$5000 - $50000`）。
  - **评分数**：范围选择（例如 `50 - 1000`）。
  - **评分**：范围选择（例如 `4.0 - 5.0`）。
  - **上架至今**：范围选择（例如 `0 - 30 天`）。
  - **配送方式**：多选（例如 `FBA`、`FBM`）。
  - **卖家所属地**：多选（例如 `CN`、`US`）。
  - **类目黑名单**：
    - 从 Firebase Cloud FireStore 获取黑名单数据。
    - 类目格式化：对 `小类目` 字段进行处理（`.replaceAll(" ","").replaceAll("&","").replaceAll("'","").replaceAll(",","")`），例如 `Table cloths` 格式化为 `Tablecloths`。
    - 筛选逻辑：排除黑名单中的类目（`is_exclude: true`）。
- **界面**：
  - 提供筛选面板，包含滑块（用于范围选择）和下拉框（用于多选）。
  - 支持多条件组合筛选。
- **实时更新**：筛选条件调整后，立即更新卡片列表。

### 2.4 Firebase 集成
- **功能描述**：与 Firebase Cloud FireStore 交互，获取类目黑名单。
- **数据结构**：
  - 集合路径：`firestore_collection_category`。
  - 文档 ID：格式化后的小类目名称（例如 `Tablecloths`）。
  - 字段：`is_exclude`（布尔值，`true` 表示黑名单，`false` 表示非黑名单）。
- **实现细节**：
  - 使用 Firebase SDK 初始化并连接到 FireStore。
  - 实时获取黑名单数据，缓存到前端以提高性能。
  - 在筛选时，将产品的小类目与黑名单匹配，排除 `is_exclude: true` 的类目。

---

## 3. 非功能需求

### 3.1 性能
- 文件解析速度快，处理 2000 行数据不超过 5 秒。
- 筛选操作实时响应，延迟小于 500 毫秒。
- 卡片列表支持懒加载，减少初始加载时间。

### 3.2 安全性
- 上传文件验证：限制文件类型为 `.xlsx`，最大大小 10MB。
- Firebase 访问控制：配置规则，确保只有授权用户可访问黑名单数据。
- 数据脱敏：展示信息时，避免泄露敏感字段（如卖家详细信息）。

### 3.3 用户体验
- 界面简洁直观，筛选条件易于操作。
- 提供错误提示，例如文件格式错误或上传失败。
- 支持筛选条件保存功能，用户可保存常用筛选设置。

---

## 4. 技术栈
- **前端**：Next.js（React 框架，用于构建用户界面和处理交互）。
- **文件解析**：`xlsx` 库（用于解析 `.xlsx` 文件）。
- **数据库交互**：Firebase SDK（与 Cloud FireStore 交互）。
- **样式**：Tailwind CSS（可选，用于快速构建美观界面）。
- **部署**：Vercel（推荐，Next.js 原生支持）。

---

## 5. 系统架构
- **前端**：
  - 负责文件上传、解析、展示和筛选逻辑。
  - 使用 React 状态管理（例如 `useState` 或 Redux）存储产品数据和筛选条件。
- **Firebase**：
  - 提供类目黑名单数据，实时同步到前端。
- **数据流**：
  1. 用户上传 `xlsx` 文件。
  2. 前端解析文件，提取产品信息。
  3. 从 Firebase 获取类目黑名单。
  4. 根据筛选条件和黑名单过滤产品。
  5. 展示过滤后的卡片列表。
  6. 用户点击卡片，跳转到亚马逊产品页。

---

## 6. 界面设计

### 6.1 上传界面
- **元素**：
  - 文件上传按钮（`<input type="file">`）。
  - 上传进度条（显示百分比）。
  - 提示信息（成功或错误消息）。
- **样式**：居中布局，按钮醒目。

### 6.2 筛选界面
- **元素**：
  - 价格范围滑块（双向滑块）。
  - 月销量、月销售额、评分数、评分范围滑块。
  - 上架至今的时间选择（下拉菜单，例如 `最近 7 天`、`最近 30 天`）。
  - 配送方式和卖家所在地多选下拉框。
- **样式**：侧边栏布局，条件分组清晰。

### 6.3 卡片展示界面
- **元素**：
  - 卡片列表（网格布局，每行 2-3 张卡片）。
  - 卡片结构：左侧主图（固定大小，例如 200x200px），右侧信息（字段列表）。
  - 分页控件（上一页、下一页按钮）。
- **样式**：响应式设计，适配桌面和移动端。

---

## 7. 数据流
1. 用户点击上传按钮，选择 `xlsx` 文件。
2. 前端使用 `xlsx` 库解析文件，提取产品数据。
3. 初始化 Firebase SDK，从 FireStore 获取类目黑名单。
4. 根据用户输入的筛选条件和黑名单，过滤产品数据。
5. 将过滤后的数据渲染为卡片列表。
6. 用户点击卡片，通过 `window.open` 跳转到亚马逊产品页。

---

## 8. 优化建议

### 8.1 性能优化
- **懒加载**：仅加载当前页的卡片数据，使用 Intersection Observer 实现。
- **数据缓存**：将黑名单数据缓存到本地（如 `localStorage`），减少网络请求。
- **批量处理**：解析大文件时分批处理，避免阻塞主线程。

### 8.2 用户体验优化
- **筛选预设**：提供常用筛选组合（例如 “高销量低竞争”），用户一键应用。
- **加载动画**：在解析文件和筛选时显示加载动画。
- **响应式设计**：确保移动端也能正常使用。

### 8.3 安全性优化
- **文件校验**：上传前检查文件头，确保是合法的 Excel 文件。
- **错误日志**：记录解析和筛选中的错误，便于调试。

---

## 9. 开发计划
- **阶段 1**：实现文件上传和解析功能（1 周）。
- **阶段 2**：实现卡片展示和分页功能（1 周）。
- **阶段 3**：实现筛选功能和 Firebase 集成（1 周）。
- **阶段 4**：优化性能和用户体验（1 周）。
- **阶段 5**：测试和部署（1 周）。

---

## 10. 风险与挑战
- **文件格式不一致**：卖家精灵导出的 `xlsx` 文件可能存在字段缺失或格式变化，需增加容错处理。
- **Firebase 配置**：权限设置不当可能导致数据泄露，需严格测试访问规则。
- **性能瓶颈**：处理超大文件（例如 5000+ 行）可能导致卡顿，需优化解析逻辑。

---

## 11. 验收标准
- 用户可以成功上传 `xlsx` 文件并解析出产品信息。
- 卡片展示包含所有指定字段，主图和信息布局正确。
- 筛选功能正常，支持多条件组合和黑名单过滤。
- 点击卡片能正确跳转到亚马逊产品页。
- 系统响应迅速，界面友好，无明显 Bug。